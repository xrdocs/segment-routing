Segment Routing Global Block (SRGB) Clarence Filsfils Kris Michielsen Segment Routing Global Block (SRGB) What is the Segment Routing Global Block Benefits of using same SRGB on all Segment Routing nodes How to modify Segment Routing Global Block SRGB allocation mechanism 2015 Cisco and or its affiliates. All rights reserved. 2 SR Global Block (SRGB) 2015 Cisco and or its affiliates. All rights reserved. 3 Segment Routing Global Block (SRGB) Segment Routing Global Block Range of labels reserved for Segment Routing Global Segments Default SRGB is 16 000 23 999 A prefix-SID is advertised as a domain-wide unique index The Prefix-SID index points to a unique label within the SRGB Index is zero based i.e. first index 0 Label Prefix-SID index + SRGB base E.g. Prefix 1.1.1.65 32 with prefix-SID index 65 gets label 16065 2015 Cisco and or its affiliates. All rights reserved. 4 Segment Routing Global Block (SRGB) Strongly recommended to use same SRGB on all nodes All operators asked for this deployment model Simple straightforward Global Segment Global Label value Using different SRGBs is supported but complicates operations for user A non-default SRGB can be allocated between 16 000 and 1 048 575 Or up to the platform limit if any The size of the SRGB should be equal on all nodes Current maximum size is 64k 2015 Cisco and or its affiliates. All rights reserved. 5 Segment Routing Global Block (SRGB) 4 16 000 3 16 000 1 2 16 000 e c a p s l e b a l l e b a l i a v A 1 048 575 1 048 575 1 048 575 2015 Cisco and or its affiliates. All rights reserved. 6 Not recommended but possible SRGB allocation 1.1.1.1 32 Prefix Segment index 1 4 B G R S Idx 0 16 000 16 000 16 000 Idx 7 999 23 999 24 000 Non-recommended SRGB allocation Different SRGBs B G R S 1 048 575 1 048 575 3 16 000 16 000 533 334 533 335 Idx 0 Idx 7 999 541 334 541 335 1 048 575 1 048 575 2 1 B G R S Idx 0 16 000 16 000 16 000 Idx 7 999 23 999 24 000 1 048 575 1 048 575 2015 Cisco and or its affiliates. All rights reserved. 7 Not recommended but possible SRGB allocation 1.1.1.1 32 Prefix Segment index 1 4 16001 Payload B G R S Idx 0 Idx 1 16 000 16 000 16 001 Idx 7 999 23 999 24 000 1 048 575 533336 Payload 3 16 000 B G R S 533 334 533 335 533 336 Idx 0 Idx 1 Idx 7 999 541 334 541 335 1 048 575 16001 Payload B G R S 2 1 16001 Payload Idx 0 Idx 1 16 000 16 000 16 001 Idx 7 999 23 999 24 000 1 048 575 2015 Cisco and or its affiliates. All rights reserved. 8 Recommended SRGB allocation 4 16001 Payload B G R S Idx 0 Idx 1 16 000 16 000 16 001 Idx 7 999 23 999 24 000 1.1.1.1 32 Prefix Segment index 1 3 2 1 16001 Payload B G R S 16001 Payload B G R S 16001 Payload Idx 0 Idx 1 16 000 16 000 16 001 Idx 7 999 23 999 24 000 Idx 0 Idx 1 16 000 16 000 16 001 Idx 7 999 23 999 24 000 Recommended SRGB allocation same SRGB for all Prefix-SID has global label value 1 048 575 1 048 575 1 048 575 2015 Cisco and or its affiliates. All rights reserved. 9 Recommended SRGB allocation 4 16001 Payload B G R S Idx 0 Idx 1 16 000 16 000 16 001 Idx 7 999 23 999 24 000 1.1.1.1 32 Prefix Segment index 1 3 2 1 16001 Payload B G R S 16001 Payload B G R S 16001 Payload Idx 0 Idx 1 16 000 16 000 16 001 Idx 7 999 23 999 24 000 Idx 0 Idx 1 16 000 16 000 16 001 Idx 7 999 23 999 24 000 Same SRGB prefix-SID has Global label value Simple predictable Much easier to troubleshoot Simplifies SDN programming 1 048 575 1 048 575 1 048 575 2015 Cisco and or its affiliates. All rights reserved. 10 Label Switching Database (LSD) Local label allocation is managed by Label Switching Database (LSD) MPLS Applications must register as client with LSD to allocate labels MPLS Applications are e.g. IGP LDP RSVP MPLS static Label space carving of Segment Routing capable software release (even if Segment Routing is not enabled) Label range 0-15 reserved for special-purposes Label range 16-15 999 reserved for static MPLS labels Label range 16 000-23 999 preserved for SRGB Label range 24 000-max used for dynamic label allocation 2015 Cisco and or its affiliates. All rights reserved. 11 Label Switching Database (LSD) Most MPLS Applications use labels dynamically allocated by LSD LDP RSVP L2VPN BGP (LU VPN) IS-IS (Adj-SID) OSPF (Adj- SID) TE (Binding-SID) Dynamic labels are allocated from the dynamic label range (above the preserved SRGB label range) more details later in this section 2015 Cisco and or its affiliates. All rights reserved. 12 SRGB label range preservation LSD preserves the default SRGB label range 16 000-23 999 In any Segment Routing capable software release Even if Segment Routing is not enabled Except if the configured mpls label range includes this default range LSD allocates dynamic labels starting from 24 000 If the configured mpls label range includes the default SRGB label range the default preservation is disabled E.g. mpls label range 16000 1048575 2015 Cisco and or its affiliates. All rights reserved. 13 SRGB label range preservation Preservation of the default SRGB label range makes future Segment Routing activation possible without reboot No labels are allocated from that preserved range. When enabling Segment Routing with default SRGB some time in the future that label range is available and ready for use See illustration further in this presentation 2015 Cisco and or its affiliates. All rights reserved. 14 LSD SRGB allocation mechanism Upon boot LSD does not accept any dynamic label allocation before ISIS OSPF have registered with LSD Upon ISIS OSPF registration LSD allocates the requested SRGB If Segment Routing not enabled ISIS OSPF don t request an SRGB No SRGB is allocated If Segment Routing is enabled ISIS OSPF request an SRGB either as per customized SRGB configuration or the default 16000 23999 if Segment Routing enabled without customized SRGB Once ISIS OSPF have registered and their SRGB is allocated LSD starts serving dynamic label requests from other clients LSD preserves the label range 16 000-23 999 by default even if not used as SRGB 2015 Cisco and or its affiliates. All rights reserved. 15 LSD SRGB allocation Example An example sequence of events after a router booted 1. LSD waits for high priority clients Special-purpose and static labels Preserved range 0 15 999 16 000 23 999 24 000 Dynamic label range 1 048 575 2015 Cisco and or its affiliates. All rights reserved. 16 LSD SRGB allocation Example An example sequence of events after a router booted 1. LSD waits for high priority clients IS-IS registers with LSD requests default SRGB 16 000-23 999 Special-purpose and static labels IS-IS SRGB 0 15 999 16 000 23 999 24 000 Dynamic label range 1 048 575 2015 Cisco and or its affiliates. All rights reserved. 17 LSD SRGB allocation Example An example sequence of events after a router booted 1. LSD waits for high priority clients IS-IS registers with LSD requests default SRGB 16 000-23 999 2. All high priority clients have registered LSD starts allocating labels LDP requests dynamic labels ( in diagram) Special-purpose and static labels IS-IS SRGB 0 15 999 16 000 23 999 24 000 Dynamic label range 1 048 575 2015 Cisco and or its affiliates. All rights reserved. 18 LSD SRGB allocation Example Another example sequence of events after a router booted (using non-default SRGB) 1. LSD waits for high priority clients Special-purpose and static labels Preserved range 0 15 999 16 000 23 999 24 000 Dynamic label range 1 048 575 2015 Cisco and or its affiliates. All rights reserved. 19 LSD SRGB allocation Example Another example sequence of events after a router booted (using non-default SRGB) 1. LSD waits for high priority clients IS-IS registers with LSD requests SRGB 30 000-39 999 0 15 999 16 000 23 999 24 000 29 999 30 000 39 999 40 000 1 048 575 Special-purpose and static labels Preserved range Dynamic label range IS-IS SRGB Dynamic label range 2015 Cisco and or its affiliates. All rights reserved. 20 LSD SRGB allocation Example Another example sequence of events after a router booted (using non-default SRGB) 1. LSD waits for high priority clients IS-IS registers with LSD requests SRGB 30 000-39 999 2. All high priority clients have registered LSD starts allocating labels LDP requests dynamic labels ( in diagram) Note that LSD preserves the Preserved Range 0 15 999 16 000 23 999 24 000 29 999 30 000 39 999 40 000 1 048 575 Special-purpose and static labels Preserved range Dynamic label range IS-IS SRGB Dynamic label range 2015 Cisco and or its affiliates. All rights reserved. 21 LSD SRGB preservation Example An example sequence of Segment Routing activation 1. No Segment Routing enabled no SRGB allocated LSD preserves default SRGB label range Dynamic labels are allocated by various MPLS applications ( in diagram) Special-purpose and static labels Preserved range 0 15 999 16 000 23 999 24 000 Dynamic label range 1 048 575 2015 Cisco and or its affiliates. All rights reserved. 22 LSD SRGB preservation Example An example sequence of Segment Routing activation 1. No Segment Routing enabled no SRGB allocated LSD preserves default SRGB label range Dynamic labels are allocated by various MPLS applications ( in diagram) 2. Sometime later Segment Routing IS-IS is enabled with default SRGB SRGB label range is free (preserved) start using Segment Routing without reboot Special-purpose and static labels IS-IS SRGB 0 15 999 16 000 23 999 24 000 Dynamic label range 1 048 575 2015 Cisco and or its affiliates. All rights reserved. 23 Segment Routing Global Block (SRGB) Notes Multiple IGP instances can use the same SRGB or use different non-overlapping SRGBs Modifying a SRGB configuration is disruptive for traffic And may require a reboot if the new SRGB is not (entirely) available 2015 Cisco and or its affiliates. All rights reserved. 24 Segment Routing Global Block (SRGB) Default SRGB RP 0 0 CPU0 xrvr-1 show mpls label table detail Table Label Owner State Rewrite ----- ------- ------------------------------- ------ ------- ...snip... 0 16000 ISIS(A) 1 InUse No (Lbl-blk SRGB vers 0 (start_label 16000 size 8000) 0 24000 ISIS(A) 1 InUse Yes (SR Adj Segment IPv4 vers 0 index 1 type 0 intf Gi0 0 0 0 nh 10.0.0.2) IS-IS SRGB Start_label 16 000 Size 8 000 Default SRGB label block allocation for ISIS 16 000 23 999 2015 Cisco and or its affiliates. All rights reserved. 25 Segment Routing Global Block (SRGB) Non-default SRGB Example router isis 1 segment-routing global-block 18000 19999 18 000 19 999 Configure a non-default SRGB RP 0 0 CPU0 xrvr-1 show mpls label table detail Table Label Owner State Rewrite ----- ------- ------------------------------- ------ ------- ...snip... 0 18000 ISIS(A) 1 InUse No (Lbl-blk SRGB vers 0 (start_label 18000 size 2000) 0 24000 ISIS(A) 1 InUse Yes (SR Adj Segment IPv4 vers 0 index 1 type 0 intf Gi0 0 0 0 nh 10.0.0.2) IS-IS SRGB Start_label 18 000 Size 2 000 Non-default SRGB label block allocation for ISIS 18 000 19 999 2015 Cisco and or its affiliates. All rights reserved. 26 Visit us cisco.com segment-routing.net Acknowledgements Ahmed Bashandy Robert Hanzl Steven Luong Stefano Previdi Peter Psenak Thank you. 